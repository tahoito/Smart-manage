<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/css/styles.css}" rel="stylesheet">
	<link th:href="@{/css/index.css}" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<title>Smart Manage</title>
</head>
<body>
	<div th:replace="~{block/header::headerAccount}"></div>

	<div class="container">
		<section class="list">
			<h1 class="main_title">æ”¯å‡ºä¸€è¦§</h1>
			<table class="table">
				<tr>
					<th>æ—¥æ™‚</th>
					<th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
					<th>ãƒ¡ãƒ¢</th>
					<th>é‡‘é¡</th>
					<th></th>
					<th></th>
				</tr>
				
				<tr th:each="account : ${list}" th:if="${account.type < 10}">
					<td th:text="${account.date}"></td>
					<td th:switch="${account.type}">
						<span th:case="1">é£Ÿè²»</span>
						<span th:case="2">æ—¥ç”¨å“</span>
						<span th:case="3">äº¤é€šè²»</span>
						<span th:case="4">è¶£å‘³</span>
						<span th:case="5">éŠã³ä»£</span>
						<span th:case="6">å‹‰å¼·</span>
						<span th:case="7">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</span>
						<span th:case="8">ç¾å®¹</span>
						<span th:case="*">ãã®ä»–</span>
					</td>			
					<td th:text="${account.item}"></td>
					<td th:text="${account.price} + 'å††'"></td>
					<td><a th:href="@{/account/updateInput(id=${account.id})}"><input type="button" value="æ›´æ–°" class="button"></a></td>
					<td>
						<form th:action="@{/account/delete}" method="post" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
							<input type="hidden" name="id" th:value="${account.id}">
							<input type="submit" value="å‰Šé™¤" class="button">
						</form>	
					</td>						
				</tr>
			</table>
			<div class="line"></div>

			<h1 class="main_title">æœ€è¿‘ã®åå…¥</h1>
			<table class="table">
				<tr>
					<th>æ—¥æ™‚</th>
					<th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
					<th>ãƒ¡ãƒ¢</th>
					<th>é‡‘é¡</th>
					<th></th>
					<th></th>
				</tr>

				<tr th:each="account : ${list}" th:if="${account.type >= 10}">
					<td th:text="${account.date}"></td>
					<td th:switch="${account.type}">
						<span th:case="10">çµ¦ä¸</span>
						<span th:case="11">ã‚¢ãƒ«ãƒã‚¤ãƒˆ</span>
						<span th:case="12">å‰¯æ¥­</span>
						<span th:case="13">æŠ•è³‡</span>
						<span th:case="14">ãŠå°é£ã„</span>
						<span th:case="15">è‡¨æ™‚åå…¥</span>
						<span th:case="16">ãã®ä»–</span>
					</td>			
					<td th:text="${account.item}"></td>
					<td th:text="${account.price} + 'å††'"></td>
					<td><a th:href="@{/account/updateIncomeInput(id=${account.id})}"><input type="button" value="æ›´æ–°" class="button"></a></td>
					<td>
						<form th:action="@{/account/deleteIncome}" method="post" onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
							<input type="hidden" name="id" th:value="${account.id}">
							<input type="submit" value="å‰Šé™¤" class="button">
						</form>	
					</td>						
				</tr>
			</table>
			<div class="line"></div>

		</section>

		<section class="chart">
			<canvas id="expenseChart"></canvas>
			<script th:inline="javascript">
				var expenseData = /*[[${expenseData}]]*/ {};
			
				var categoryColors = {
					"é£Ÿè²»": "#ff6384",
					"æ—¥ç”¨å“": "#36a2eb",
					"äº¤é€šè²»": "#ffce56",
					"è¶£å‘³": "#ff9f40",
					"éŠã³ä»£": "#4bc0c0",
					"å‹‰å¼·": "#9966ff",
					"ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³": "#ffcc99",
					"ç¾å®¹": "#c9cbcf",
					"ãã®ä»–": "#8e8e8e"
				};
			
				// ğŸ”¹ åå…¥ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆã‚°ãƒ©ãƒ•ã«å«ã‚ãªã„ã‚‚ã®ï¼‰
				var incomeCategories = ["çµ¦ä¸", "ã‚¢ãƒ«ãƒã‚¤ãƒˆ", "å‰¯æ¥­", "æŠ•è³‡", "ãŠå°é£ã„", "è‡¨æ™‚åå…¥", "ãã®ä»–"];
			
				// ğŸ”¹ åå…¥ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–ã—ã¦æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’å–å¾—
				var filteredExpenseData = {};
				for (var key in expenseData) {
					if (!incomeCategories.includes(key)) { // ğŸ’¡ åå…¥ãªã‚‰é™¤å¤–ï¼
						filteredExpenseData[key] = expenseData[key];
					}
				}
			
				// ğŸ”¹ æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã‚’æç”»ï¼
				var labels = Object.keys(filteredExpenseData);
				var data = Object.values(filteredExpenseData);
				var colors = labels.map(label => categoryColors[label] || "#000000");
			
				var ctx = document.getElementById("expenseChart").getContext("2d");
				new Chart(ctx, {
					type: "pie",
					data: {
						labels: labels,
						datasets: [{
							data: data,
							backgroundColor: colors,
						}]
					}
				});
			</script>
						
			<div class="summary">
				<div class="summary-item">
					<h2>ç·åå…¥</h2>
					<p><span th:text="${totalIncome}"></span> å††</p>
				</div>
				<div class="summary-item">
					<h2>ç·æ”¯å‡º</h2>
					<p><span th:text="${totalPrice}"></span> å††</p>
				</div>
				<div class="summary-item balance">
					<h2>æ®‹é¡</h2>
					<p><span th:text="${balance}"></span> å††</p>
				</div>
			</div>

		</section>

		<div class="icon_add">
			<a href="/account/insert" class="write-add expense">
				<i class="fa-solid fa-minus"></i><span></span> 
			</a>
			
			<a href="/account/insertIncome" class="write-add income">
				<i class="fa-solid fa-plus"></i><span></span> 
			</a>
		</div>
		
		
		<!--<section class="add">
			<h1 class="add_title">æ”¯å‡ºã®è¿½åŠ </h1>
			<div class="add_space">
				<form th:action="@{/account/insert}" method="post">
					<div class="date">
						<div class="flex-container">
							<label>æ—¥æ™‚:</label>
							<input type="date" name="date" required>
						</div>
					</div>
					<div class="type">
						<div class="flex-container">
							<label>ã‚«ãƒ†ã‚´ãƒªãƒ¼:</label>
							<select id="category" name="type" required>
								<option value="1">é£Ÿè²»</option>
								<option value="2">æ—¥ç”¨å“</option>
								<option value="3">äº¤é€šè²»</option>
								<option value="4">è¶£å‘³</option>
								<option value="5">éŠã³ä»£</option>
								<option value="6">å‹‰å¼·</option>
								<option value="7">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</option>
								<option value="8">ç¾å®¹</option>
								<option value="*">ãã®ä»–</option>
							</select>
						</div>
					</div>
		
					<div class="item">
						<div class="flex-container">
							<label>ãƒ¡ãƒ¢:</label>
							<input type="text" name="item" maxlength="15" size="30" required>
						</div>
					</div>
		
					<div class="price">
						<div class="flex-container">
							<label>é‡‘é¡:</label>
							<input type="number" name="price" oninput="sliceMaxlength(this,8)" required>å††   
						</div>         
					</div>
					<div class="insert_buttom">
						<input class="buttom" type="submit" value="è¿½åŠ ">
					</div>
				</form>
			</div>
		</section>-->
	</div>
    
    <script>
        function sliceMaxlength(elem,maxlength){
            elem.value= elem.value.slice(0,maxlength);
        }
		function confirmDelete(url) {
		if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
			window.location.href = url; // å‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œ
		}
	}
    </script>

	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/script.js}"></script>
	
</body>
</html>
