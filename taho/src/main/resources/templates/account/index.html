<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/css/styles.css}" rel="stylesheet">
	<link th:href="@{/css/index.css}" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<title>Smart Manage</title>
</head>
<body>
	<div th:replace="~{block/header::headerAccount}"></div>

		<div class="container">

			<div class="summary-chart-wrapper">
				<section class="summary">
					<div class="summary-item">
						<h2>ç·åå…¥</h2>
						<p><span th:text="${totalIncome}"></span> å††</p>
					</div>
					<div class="summary-item">
						<h2>ç·æ”¯å‡º</h2>
						<p><span th:text="${totalPrice}"></span> å††</p>
					</div>
					<div class="summary-item balance">
						<h2>æ®‹é¡</h2>
						<p><span th:text="${balance}"></span> å††</p>
					</div>

					<div class="goal_graph">
						<canvas id="myChart"></canvas>
						<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
						<script>
							const ctx = document.getElementById('myChart');

							const targetSaving = [[${targetSaving}]];
							const targetExpensing = [[${targetExpensing}]];

							new Chart(ctx, {
								type: 'bar',
								data: {
									labels: ['è²¯é‡‘ç›®æ¨™', 'æ”¯å‡ºç›®å®‰'],
									datasets: [{
										label: 'é‡‘é¡ï¼ˆå††ï¼‰',
										data: [targetSaving, targetExpensing],
									}]
								}
							});
						</script>
					</div>

					<div class="profile_button">
						<a href="/profile/edit" class="btn btn-primary">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†</a>
					</div>
				</section>

				<section class="chart">
					<canvas id="expenseChart"></canvas>
					<script th:inline="javascript">
						var expenseData = /*[[${expenseData}]]*/ {};
					
						var categoryColors = {
							"é£Ÿè²»": "#ff6384",
							"æ—¥ç”¨å“": "#36a2eb",
							"äº¤é€šè²»": "#ffce56",
							"è¶£å‘³": "#ff9f40",
							"éŠã³ä»£": "#4bc0c0",
							"å‹‰å¼·": "#9966ff",
							"ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³": "#ffcc99",
							"ç¾å®¹": "#c9cbcf",
							"ãã®ä»–": "#8e8e8e"
						};
					
						//åå…¥ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆã‚°ãƒ©ãƒ•ã«å«ã‚ãªã„ã‚‚ã®ï¼‰
						var incomeCategories = ["çµ¦ä¸", "ã‚¢ãƒ«ãƒã‚¤ãƒˆ", "å‰¯æ¥­", "æŠ•è³‡", "ãŠå°é£ã„", "è‡¨æ™‚åå…¥", "ãã®ä»–"];
					
						//åå…¥ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–ã—ã¦æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’å–å¾—
						var filteredExpenseData = {};
						for (var key in expenseData) {
							if (!incomeCategories.includes(key)) { // ğŸ’¡ åå…¥ãªã‚‰é™¤å¤–ï¼
								filteredExpenseData[key] = expenseData[key];
							}
						}
					
						//æ”¯å‡ºãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’ä½¿ã£ã¦ã‚°ãƒ©ãƒ•ã‚’æç”»ï¼
						var labels = Object.keys(filteredExpenseData);
						var data = Object.values(filteredExpenseData);
						var colors = labels.map(label => categoryColors[label] || "#000000");
					
						var ctx = document.getElementById("expenseChart").getContext("2d");
						new Chart(ctx, {
							type: "pie",
							data: {
								labels: labels,
								datasets: [{
									data: data,
									backgroundColor: colors,
								}]
							}
						});
					</script>
				</section>
			</div>
		
			<div class="icon_add">
				<a href="/account/insert" class="write-add">
					<i class="fa-solid fa-pen"></i><span></span> 
				</a>
			</div>
		</div>

	<script>
		function sliceMaxlength(elem,maxlength){
            elem.value= elem.value.slice(0,maxlength);
        }
		function confirmDelete(url) {
		if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
			window.location.href = url; // å‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œ
		}
		}
	</script>
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/script.js}"></script>
</body>
</html>