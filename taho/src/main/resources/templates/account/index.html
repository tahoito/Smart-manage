<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/css/styles.css}" rel="stylesheet">
	<link th:href="@{/css/index.css}" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<title>Smart Manage</title>
</head>
<body>
	<div th:replace="~{block/header::headerAccount}"></div>

	<div class="container">
		<section class="list">
			<h1 class="main_title">支出一覧</h1>
			<div class="line"></div>
			<table class="table">
    		<tr>
        		<th>日時</th>
        		<th>カテゴリー</th>
        		<th>メモ</th>
        		<th>金額</th>
        		<th></th>
        		<th></th>
    		</tr>

    		<tr th:each="account : ${list}" th:if="${account.type < 10}">
        		<td th:text="${account.date}"></td>
        		<td th:switch="${account.type}">
            		<span th:case="1">食費</span>
            		<span th:case="2">日用品</span>
            		<span th:case="3">交通費</span>
            		<span th:case="4">趣味</span>
            		<span th:case="5">遊び代</span>
            		<span th:case="6">勉強</span>
            		<span th:case="7">ファッション</span>
            		<span th:case="8">美容</span>
            		<span th:case="*">その他</span>
				</td>			
        		<td th:text="${account.item}"></td>
        		<td th:text="${account.price} + '円'"></td>
        		<td><a th:href="@{/account/updateInput(id=${account.id})}"><input type="button" value="更新" class="button"></a></td>
        		<td>
            		<form th:action="@{/account/delete}" method="post" onsubmit="return confirm('本当に削除しますか？')">
                		<input type="hidden" name="id" th:value="${account.id}">
                		<input type="submit" value="削除" class="button">
            		</form>	
        		</td>						
    		</tr>
			</table>
			<div class="line"></div>

			<h1 class="main_title">最近の収入</h1>
				<table class="table">
				<tr>
					<th>日時</th>
					<th>項目</th>
					<th>メモ</th>
					<th>金額</th>
					<th></th>
					<th></th>
				</tr>
				<tr th:each="account : ${list}" th:if="${account.type < 10}">
					<td th:text="${account.date}"></td>
					<td th:switch="${account.type}">
						<span th:case="1">食費</span>
						<span th:case="2">日用品</span>
						<span th:case="3">交通費</span>
						<span th:case="4">趣味</span>
						<span th:case="5">遊び代</span>
						<span th:case="6">勉強</span>
						<span th:case="7">ファッション</span>
						<span th:case="8">美容</span>
						<span th:case="*">その他</span>
					</td>			
					<td th:text="${account.item}"></td>
					<td th:text="${account.price} + '円'"></td>
					<td><a th:href="@{/account/updateInput(id=${account.id})}"><input type="button" value="更新" class="button"></a></td>
					<td>
						<form th:action="@{/account/delete}" method="post" onsubmit="return confirm('本当に削除しますか？')">
							<input type="hidden" name="id" th:value="${account.id}">
							<input type="submit" value="削除" class="button">
						</form>	
					</td>						
					</tr>
				</table>
			<div class="line"></div>
		</section>

		<section class="chart">
			<canvas id="expenseChart"></canvas>
			<script th:inline="javascript">
    			var expenseData = /*[[${expenseData}]]*/ {};

			var categoryColors = {
				"食費": "#ff6384",
				"日用品": "#36a2eb",
				"交通費": "#ffce56",
				"趣味": "#ff9f40",
				"遊び代": "#4bc0c0",
				"勉強": "#9966ff",
				"ファッション": "#ffcc99",
				"美容": "#c9cbcf",
				"その他": "#8e8e8e"
			};

			var labels = Object.keys(expenseData);
			var data = Object.values(expenseData);
			var colors = labels.map(label => categoryColors[label] || "#000000");

			var ctx = document.getElementById("expenseChart").getContext("2d");

			new Chart(ctx, {
				type: "pie",
				data: {
					labels: labels,
					datasets: [{
						data: data,
						backgroundColor: colors,
					}]
					}
				});
			</script>   
			<h1 class="main_title">総収入<span th:text="${totalIncome} + '円'"></span></h1>
			<h1 class="main_title">総支出<span th:text="${totalPrice} + '円'"></span></h1>
			<h1 class="main_title">残額<span th:text="${balance} + '円'"></span></h1>
		</section>

		<div class="icon_add">
			<a href="/account/insert" class="write-add"><i class="fa-solid fa-pen-to-square"></i></a>
		</div>
		
	
		<!--<section class="add">
			<h1 class="add_title">支出の追加</h1>
			<div class="add_space">
				<form th:action="@{/account/insert}" method="post">
					<div class="date">
						<div class="flex-container">
							<label>日時:</label>
							<input type="date" name="date" required>
						</div>
					</div>
					<div class="type">
						<div class="flex-container">
							<label>カテゴリー:</label>
							<select id="category" name="type" required>
								<option value="1">食費</option>
								<option value="2">日用品</option>
								<option value="3">交通費</option>
								<option value="4">趣味</option>
								<option value="5">遊び代</option>
								<option value="6">勉強</option>
								<option value="7">ファッション</option>
								<option value="8">美容</option>
								<option value="*">その他</option>
							</select>
						</div>
					</div>
		
					<div class="item">
						<div class="flex-container">
							<label>メモ:</label>
							<input type="text" name="item" maxlength="15" size="30" required>
						</div>
					</div>
		
					<div class="price">
						<div class="flex-container">
							<label>金額:</label>
							<input type="number" name="price" oninput="sliceMaxlength(this,8)" required>円   
						</div>         
					</div>
					<div class="insert_buttom">
						<input class="buttom" type="submit" value="追加">
					</div>
				</form>
			</div>
		</section>-->
	</div>
    
    <script>
        function sliceMaxlength(elem,maxlength){
            elem.value= elem.value.slice(0,maxlength);
        }
		function confirmDelete(url) {
		if (confirm("本当に削除しますか？")) {
			window.location.href = url; // 削除処理を実行
		}
	}
    </script>

	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/script.js}"></script>
	
</body>
</html>
